# Workflow for checking the integrity of datasets to ensure that they have not been tampered with or corrupted.
name: Dataset Integrity Check

on:
  push:
    branches:
      - main 
      - dev

jobs:
  check_integrity:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 

      - name: Change directory to train data
        run: cd path_datasets/train

      - name: Calculate checksums for train data
        run: |
          find . -name "*.csv" -type f -exec sha256sum {} \; > ../new_checksums_train.txt 

      - name: Change directory to test data
        run: cd ../test 

      - name: Calculate checksums for test data
        run: |
          find . -name "*.csv" -type f -exec sha256sum {} \; > ../new_checksums_test.txt

      - name: Change directory to path_datasets
        run: cd .. 

      - name: Compare train checksums
        run: diff checksums_train.txt new_checksums_train.txt

      - name: Compare test checksums
        run: diff checksums_test.txt new_checksums_test.txt

      - name: Fail if differences found
        if: failure()
        run: echo "Data integrity check failed, please check the differences above" && exit 1
